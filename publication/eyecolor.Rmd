---
title: My Awesome Catchy Title!
author: |
  | Kasthury Inparajah $^1$, Willem-Daniël Visser $^1$, Cheyenne Brouwer $^1$, Demi van `t Oever $^1$, 
  | Michiel Noback $^1$, Fenna Feenstra $^1$
  | $^1$Hanzehogeschool,
lang: nl
abstract: |
  Geef hier je samenvatting in maximaal 150 woorden. Het is een samenvatting van het hele artikel; niet alleen de resultaten! Begin met het belang van dit onderzoek, dan hoe het onderzoek is aangepakt en de belangrijkste resultaten en eindig met de implicaties ervan voor de wetenschap/de maatschappij. Neem nooit figuren of tabellen op in de samenvatting.
bibliography: eyecolor.bib

output:
  bookdown::pdf_document2:
    keep_tex: false
    toc: false
    fig_caption: true
    includes:  
        in_header: include_tex_header.tex #will include rules for linespacing and figure floating
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, message=FALSE, warning=FALSE, include=FALSE}
knitr::opts_chunk$set(out.width = '100%', dpi=300) # configuratie voor figuur grootte en resolutie
knitr::opts_chunk$set(echo = FALSE)

library(ggplot2)
library(tidyverse)
library(knitr)
```

# Introductie

## Materialen en Methoden

Op de github voor dit onderzoek:
<https://github.com/cheyennebrouwer/eyeresearch>, staat het protocol
voor het verzamelen van de oogdata. De analisten hebben verschillende
notitie software gebruikt voor data notitie: Google Docs[\@ref(g-docs)]
door analist 8075, Apple notities[\@ref(a-notes)] door analist 5609,
Keep My Notes[\@ref(keep-my-notes)] door analist 9308 en [meer]. Hierin
hebben de analisten op 2 dagen de metingen genoteerd. Op de dag van de
metingen zijn de analisten subject groepjes(2-7) gaan vragen of deze
wouden meedoen met het onderzoek. Bij instemming is er gevraagd naar
sexe en leeftijd en zijn de analisten de ogen van de subject met zijn
allen tegelijk gaan bekijken waarbij 1 of meer van de analisten er een
referentie blaadje bij hielden. Deze staat ook in de Github. De
subjecten zijn 1 voor 1 gevraagd of ze mee wouden doen en naar
bijhorende gegevens, tot alle subjecten zijn gemeten en de volgende
groep werd aangesproken.

De analisten vulden soms twee kleuren in of een kleur karakteristiek,
zoals: donker of licht. Op dag 1 is er op de studentencampus, de
Hanzehogeschool Groningen; Zerniekeplein 11, binnen in het gebouw "Van
Doorenveste" gemeten (Groningen 1). Op dezelfde dag is er in het centrum
van Groningen (Groningen 2) gemeten. Op een dag 2 is vervolgens in het
centrum van Zwolle (Zwolle) gemeten. Op alle drie locaties was het
zonnig weer op het moment van metingen. Ook was het onder schooltijd
voor de meeste MBO en HBO studenten. Op locatie Groningen 1 was de licht
conditie niet constant met variërende daglicht reflectie, licht
temperaturen en licht amplitude. Er waren geen licht condities die de
oogkleur bepaling onmogelijk/erg moeilijk heeft gemaakt, aldus de
analisten. Op locaties Groningen 2 en Zwolle is niet rechtstreeks
richting de zon gekeken bij het bepalen van de oogkleur. Wel is er zowel
in zon als schaduw gemeten.

Toen de metingen klaar waren werden alle metingen verzameld door 1 van
de analisten en verwerkt zodat de dubbele kleuren door de analisten
genoteerd resulteren tot enkele kleuren. De verwerkte data is in tidy
vorm gezet met de functie `pivot_longer()`\` uit de tidyr
package[\@ref(tidyr)] in de programmeertaal R[\@ref(r-lang)]. Het
resultaat is opgeslagen in een nieuw bestand en zijn analyses mee
gedaan.

De analyses zijn gedaan in R-studio[\@ref(r-studio)] en de
programmeertaal R, met de libraries: plyr[\@ref(plyr)],
dyplyr[\@ref(dplyr)], ggplot2[\@ref(ggplot2)] en knitr[\@ref(knitr)] van
de tidyverse collectie. Met `plyr` en `dyplyr` is dataverwerking gedaan,
zo kon er analyse worden gedaan op gefilterde delen van de data. Met
`ggplot` zijn vervolgens grafieken gemaakt. Voor de analyse van de
meetfout tussen de analisten is de functie `chisq.test` van R gebruikt,
voor een two-way chi-square test, tussen met de factoren analist en
oogkleur, met daarvoor alle gemeten personen met een of meer lege velden
weggehaald. De analyse voor de verschillen tussen de drie meet locaties
en verschillen tussen sexe is eerst de data zonder meerderheid onder de
analisten als "undefined" neergezet, om zo aan te geven dat er geen
definitieve oogkleur valt te bepalen. Toen werd de `CrossTable` voor de
chi-square test en nog andere statistische waarden gebruikt. Hierbij is
de locatie in groepjes gezet op basis van subject id en opgezet tegen de
oogkleur. En de sexe ook opgezet tegen de oogkleur. Als analyse voor de
vergelijking van de percentages van de gemeten kleuren zijn de deze
uitgerekend en vergeleken met die van de literatuur. Bij deze analyse is
eerst ook de data waar geen meerderheid is als "undefined" neergezet.

# Resultaten

van mij

Content:

\- verschil tussen analisten

\- verschil met populatie in Nederland

\- verschil tussen locaties

\- verschil met mannen en vrouwen

```{r laad-in-meetfout-data}
file_path = "../analyse/data/Oogkleur_simpel2.csv"
eye_df <- read.table(
  file = file_path,
  header = T,
  sep = ",",
  na.strings = c("-")
)
```

```{r factorise-oogkleur-data}

eye_df$geslacht = factor(
  eye_df$geslacht,
  levels = c("M", "F"),
  labels = c("F", "M")
)
eye_df$LR = factor(
  eye_df$LR,
  levels = c("L", "R"),
  labels = c("L", "R")
)
eye_df$analist = factor(
  eye_df$analist,
  levels = c("9308", "2193", "5609", "8705"),
  labels = c("9308", "2193", "5609", "8705")
)
eye_df$oogkleur <- factor(
  eye_df$oogkleur,
  levels = c("blauw", "groen", "bruin", "hazel"),
  labels = c("blauw", "groen", "bruin", "hazel")
)
```

```{r analist-oogkleur-prep}
eye_df_na_cases <- eye_df[!complete.cases(eye_df), ]

eye_df_analist_eyecolor <- eye_df[
  !(eye_df$Identifier %in% eye_df_na_cases$Identifier),
]
eye_df_analist_eyecolor <- eye_df_analist_eyecolor %>% 
  select(analist, oogkleur)
```

## Verschil tussen analisten

```{r analist-oogkleur-chi-square, fig.cap='De geobserveerde aantal oogkleuren links+rechts per analist.'}
eye_df_analist_eyecolor_chisq <- chisq.test(
  eye_df_analist_eyecolor$analist, 
  eye_df_analist_eyecolor$oogkleur
)
knitr::kable(eye_df_analist_eyecolor_chisq$observed, longtable = TRUE, caption = "De geobserveerde aantal oogkleuren links+rechts per analist.")

eye_tbl_analist_eyecolor <- table(eye_df_analist_eyecolor)
eye_tbl_analist_eyecolor <- as.data.frame.matrix(eye_tbl_analist_eyecolor)
# Create a grouping variable based on analisten
eye_tbl_analist_eyecolor$groep <- ifelse(row.names(eye_tbl_analist_eyecolor[,0]) %in% list("9308", "2193"), "9308 & 2193", "5609 & 8705")

# Group the data and calculate average observed eye colors
grouped_data <- aggregate(
  eye_tbl_analist_eyecolor, 
  by = list(eye_tbl_analist_eyecolor$groep), 
  FUN = mean
)
colnames(grouped_data) <- c("groep", "blauw", "groen", "bruin", "hazel", "groep")

knitr::kable(grouped_data[, -6], longtable = TRUE, caption = "De geobserveerde aantal oogkleuren links+rechts per analist groep.")
```

Hier is te zien een tabel met het totale aantal metingen per oogkleur
per analist. Hieruit blijkt er geen significant verschil te zijn tussen
alle de analisten samen(p-waarde = 0,07672, α{FEM} = ,05). Tussen de
analisten 9308 en 8705 was wel een significant verschil (p-waarde =
0,03118, α{FEM} = ,05). Dit zie je ook aan de flinke verschillen tussen
de analisten bij de oogkeuren hazel(\~33,3% verschil) en groen(\~44,6%).
Oogkleur groen had ook het grootste verschil tussen de laagste aantal
metingen en hoogste metingen: 52,6% verschil. Groen was ook met 9 de
oogkleur met de grootste deviatie. Daarnaast is te zien aan de tabel dat
de twee analisten 5609 en 8705 en de twee analisten 9308 en 2193 beide
groepen vormen, aangezien ze dicht bij elkaar liggen. Hierop is nog een
`chi-square` test op los gelaten. Hier is de p-waarde 0,008905(α{FEM} =
,05). Dus is er een redelijk flink significant verschil tussen de
bovenste twee en onderste twee analisten. Uit dit alles blijkt er geen
ernstige meetfout te zitten en kan er een vergelijking worden gedaan met
de bestaande gegevens over heel Nederland om te kijken of er een
systematische meetfout is of er een verschil zit tussen Nederland breed
en de locaties die hier zijn onderzocht.

## Verschil met populatie Nederland

```{r laad-in-ookleur-data-literatuur-verg}
library(readxl)
Oogkleur_simpel <- read.table("../analyse/data/Oogkleur_simpel_definitief.csv", sep = "," , header = TRUE)
```

```{r verwerk-data-literatuur-verg}
#Schaar "hazel" onder "bruin"
Oogkleur_simpel[, grepl("^L_|^R_", colnames(Oogkleur_simpel))] <- 
  apply(Oogkleur_simpel[, grepl("^L_|^R_", colnames(Oogkleur_simpel))], 2, function(x) gsub("hazel", "bruin", x))

# Nieuwe kolom voor definitieve oogkleur
Oogkleur_simpel$Definitieve_oogkleur <- apply(Oogkleur_simpel[, grepl("^L_|^R_", colnames(Oogkleur_simpel))], 1, function(row) {
  # Tel het aantal keer oogkleur x in rij
  oogkleur_counts <- table(row)
  
  # Definitieve oogkleur wordt d.m.v. frequentie oogkleuren  bepaald
  meest_voorkomende_oogkleur <- names(oogkleur_counts)[which.max(oogkleur_counts)]
  
  # Als er geen "dominante" oogkleur is wordt het N/A
  if (length(which(oogkleur_counts == max(oogkleur_counts))) > 1) {
    meest_voorkomende_oogkleur <- NA
  }
  
  # Geef de definitieve oogkleur terug
  meest_voorkomende_oogkleur
})
```

```{r plot-data-literatuur-verg, fig.cap='Oogkleuren tegenover frequenties. Het totaal aantal waarnemingen van het rechteroogkleur. De door meerderheid waargenomen kleur onder analisten. NA als er geen meerderheid was.'}
#Plot een histogram om de waarnemingen van de oogkleuren te visualiseren 

#Kolom wordt een factor
Oogkleur_simpel$Definitieve_oogkleur <- as.factor(Oogkleur_simpel$Definitieve_oogkleur)

# Maak een plotobject met de dataset
plot_data <- ggplot(data = Oogkleur_simpel, aes(x = Definitieve_oogkleur, fill = Definitieve_oogkleur))

# Histogram met gekleurde balken toevoegen
plot_data <- plot_data + geom_bar()

# Kleuren met scale_fill_manual aanpassen
plot_data <- plot_data + scale_fill_manual(values = c("blauw" = "dodgerblue", "bruin" = "sienna", "groen" = "yellowgreen"), name="Definitieve\noogkleur")

# Titel en label toevoegen
plot_data <- plot_data +
  labs(x = "Definitieve oogkleur", y = "Frequentie", title = "Frequentie oogkleuren onderzoek")

# Weergeef histogram
print(plot_data)
```

Hier is te zien hoe blauw(52,5 %) een meerder deel van de metingen
uitmaakt, gevolgd door bruin(34,16667 %) en groen(8,333333 %). Zonder
NA-waarden komt dat neer op de verhoudingen blauw, bruin, groen (55,26%,
35,96% en 8,77%).

```{r plot-litr_data-data-literatuur-verg, fig.cap='Oogkleur tegen percentages voor data uit literatuur en dit onderzoek. Meerderheid waargenomen door analisten van het rechter oogkleur. Oogkleur percentages uit fsigenetics - "True colors: A literature review on the spatial distribution of eye and hair pigmentation" via researchgate'}
# Totaal aantal waarnemingen berekenen
totaal_waarnemingen <- nrow(Oogkleur_simpel)

# Aantal waarnemingen oogkleur tellen
aantal_groen <- sum(Oogkleur_simpel$Definitieve_oogkleur == "groen", na.rm = TRUE)
aantal_blauw <- sum(Oogkleur_simpel$Definitieve_oogkleur == "blauw", na.rm = TRUE)
aantal_bruin <- sum(Oogkleur_simpel$Definitieve_oogkleur == "bruin", na.rm = TRUE)

# Het percentage groene oogkeuren berekenen van de dataset
percentage_groen <- (aantal_groen / totaal_waarnemingen) * 100
percentage_blauw <- (aantal_blauw / totaal_waarnemingen) * 100
percentage_bruin <- (aantal_bruin / totaal_waarnemingen) * 100

#Data uit literatuuronderzoek en data uit eigen onderzoek vergelijken
#Data literatuuronderzoek
l_percentage_blauw <- 60.90
l_percentage_bruin <- 21.70
l_percentage_groen <- 11.40

# Dataframe maken met data van literatuuronderzoek
literatuuronderzoek <- data.frame(
  Oogkleur = c("blauw", "bruin", "groen"),
  Percentage = c(l_percentage_blauw, l_percentage_bruin, l_percentage_groen),
  Legenda = "Literatuuronderzoek"
)

# Dataframe maken met eigen onderzoek
eigen_onderzoek <- data.frame(
  Oogkleur = c("blauw", "bruin", "groen"),
  Percentage = c(percentage_blauw, percentage_bruin, percentage_groen),
  Legenda = "Eigen onderzoek"
)

# Samenvoegen van beide dataframes
combinatie_data <- rbind(literatuuronderzoek, eigen_onderzoek)

# Plot met data uit beide onderzoeken
plot_data <- ggplot(data = combinatie_data, aes(x = Oogkleur, y = Percentage, fill = Legenda)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Oogkleur", y = "Percentage(%)", title = "Vergelijking oogkleuronderzoek") +
  scale_fill_manual(values = c("Literatuuronderzoek" = "cyan4", "Eigen onderzoek" = "grey2"))

# Weergeef plot
print(plot_data)
```

In de barplot hierboven staat data uit een paper die informatie over de
verdeling van de oog- en haarkleur te verzamelen over populaties en deze
data als een blue print te gebruiken om de nauwkeurigheid van
voorspellingen op basis van DNA te verbeteren.[@Katsara2019tc] Dit
onderzoek heeft meerdere datasets, waaruit 3 percentages zijn gehaald
voor vergelijking met dit onderzoek. De blauw(60.9%) was hieruit de
meest voorkomende volgens de literatuur meer dan dit onderzoek
suggereert. Bruin is Nederland breed minder prevalant dan bij dit
onderzoek en bij groen is dit andersom. Om antwoord te krijgen op de of
de hanze aanleg heeft voor een bepaalde oogkleur zijn ook nog de
locaties vergeleken.

## Verschil tussen locaties

```{r, original-file-to-final-version}
file <- "../analyse/data/Oogkleur_simpel_definitief.csv"

eye_colors <- read.table(file, sep= ",", header=T)

majority2 <- function(x) {
    #print(as.character(x))
    #return("A")
    t <- table(x)
    if (length(t) == 1) return(x[1])
    else if(length(unique(t)) == 1) return("Undef.")
    else{
        df <- as.data.frame(t)
        #print(df)
        return(as.character(df[order(df$Freq, decreasing = T)[1], 1]))
    }
}

eye_colors2 <- eye_colors %>%
    rowwise() %>%
    dplyr::mutate(results = majority2(c_across(4:11))) %>%
    pivot_longer(cols = contains("_"),
               names_pattern = "(L|R)_OK(.+)",
#               names_sep = "_",
               names_to = c("Eye", "Laborant"),
               values_to = "color")
```

```{r, add-locations}
eye_colors_location <- eye_colors2 %>%
  dplyr::mutate(location = case_when(
    row_number() <= 320 ~ "Hanze Hogeschool Groningen",
    row_number() <= 640 ~ "Groningen centrum",
    row_number() <= 960 ~ "Zwolle centrum",
    TRUE ~ NA_character_
  ))
```

```{r, shorten-to-1-identifier}
Total_amount <- eye_colors_location %>%
  group_by(Identifier) %>%
  slice(1)
```

```{r, get-hanze-results}
Hanze_amount <- Total_amount[1:40, ] 

Hanze <- Hanze_amount %>%
  group_by(results) %>%
  dplyr::summarise(count = n()) %>%
  arrange(results, desc(count))
```

```{r, get-hanze-gender-results, eval=FALSE}
Hanze_gender <- Hanze_amount %>%
  group_by(results, geslacht) %>%
  dplyr::summarise(count = n(), .groups = "drop") %>%
  arrange(results, geslacht, desc(count))
```

```{r, get-centrum-groningen-results}
Centrum_amount <- Total_amount[41:80, ] 

Centrum <- Centrum_amount %>%
  group_by(results) %>%
  dplyr::summarise(count = n()) %>%
  arrange(results, desc(count))
```

```{r, get-centrum-groningen-gender-results, eval=FALSE}
Centrum_gender <- Centrum_amount %>%
  group_by(results, geslacht) %>%
  dplyr::summarise(count = n(), .groups = "drop") %>%
  arrange(results, geslacht, desc(count))
```

```{r, get-zwolle-results}
Zwolle_amount <- Total_amount[81:120, ] 

Zwolle <- Zwolle_amount %>%
  group_by(results) %>%
  dplyr::summarise(count = n()) %>%
  arrange(results, desc(count))
```

```{r, get-zwolle-gender-results, eval=FALSE}
Zwolle_gender <- Zwolle_amount %>%
  group_by(results, geslacht) %>%
  dplyr::summarise(count = n(), .groups = "drop") %>%
  arrange(results, geslacht, desc(count))
```

```{r, hanze-pie-chart, fig.cap='Taart grafiek die de verdeling van de oogkleur op de Hanze Hogeschool Groningen weergeeft.', out.width="33%"}
ggplot(data = Hanze, 
       aes(x = "", y = count, fill = results)) +
  geom_col(color = "black") +
  coord_polar(theta = "y") +
  geom_label(aes(label = count),
             position = position_stack(vjust = 0.5),
             show.legend = F) +
  ggtitle("Verdeling van oogkleur op de Hanze Hogeschool Groningen")

ggplot(data = Centrum, 
       aes(x = "", y = count, fill = results)) +
  geom_col(color = "black") +
  coord_polar(theta = "y") +
  geom_label(aes(label = count),
             position = position_stack(vjust = 0.5),
             show.legend = F) +
  ggtitle("Verdeling van oogkleur in het centrum Groningen")

ggplot(data = Zwolle, 
       aes(x = "", y = count, fill = results)) +
  geom_col(color = "black") +
  coord_polar(theta = "y") +
  geom_label(aes(label = count),
             position = position_stack(vjust = 0.5),
             show.legend = F) +
  ggtitle("Verdeling van oogkleur in het centrum Zwolle")
```

Qua locaties heeft de hanze 5-10% meer mensen met blauwe ogen dan de
andere locaties, dit vergeleken met een afwijking van 9,3% van de
literatuur en een gemiddelde afwijking van 24% kunnen deze waarnemingen
toeval zijn. In Zwolle zijn veel meer groene oogkleuren gevonden dan op
de Hanze in Groningen. Tenslotte zijn in Groningen naast blauw ook de
meeste hazel kleurige ogen gevonden. Viermaal zoveel dan in Zwolle.

```{r, hanze-gender-pie-chart, fig.cap='Sexe verschil tussen locaties Hanzehogeschool Groningen, centrum Groningen en centrum Zwolle.', eval=FALSE, out.width="33%"}

ggplot(data = Hanze_gender,
       mapping = aes(x=results, y=count, col = geslacht, fill = geslacht, group = geslacht)) +
  geom_bar(stat = "identity", position = "dodge") +
  ggtitle("Hanze hogeschool sexe") +
  geom_text(aes(label=count), position=position_dodge(width=0.9), vjust=-0.25, color = "black")

ggplot(data = Centrum_gender,
       mapping = aes(x=results, y=count, col = geslacht, fill = geslacht, group = geslacht)) +
  geom_bar(stat = "identity", position = "dodge") +
  ggtitle("Groningen centrum sexe") +
  geom_text(aes(label=count), position=position_dodge(width=0.9), vjust=-0.25, color = "black")

ggplot(data = Zwolle_gender,
       mapping = aes(x=results, y=count, col = geslacht, fill = geslacht, group = geslacht)) +
  geom_bar(stat = "identity", position = "dodge") +
  ggtitle("Zwolle centrum sexe") +
  geom_text(aes(label=count), position=position_dodge(width=0.9), vjust=-0.25, color = "black")
```

Het verschil tussen verschillende locaties is geen significant verschil
(p-waarde = 0.08554, α = 0,05). Het verschil tussen de bruine en blauwe
oogkleur ziet er wel significant uit.

## Verschil tussen mannen en vrouwen

```{r sexe-oogkleur-prep}
male_female <- eye_colors2 %>%
  group_by(Identifier) %>%
  slice(1) %>%
  group_by(geslacht, results) %>%
  dplyr::summarise(count = n(), .groups = "drop") %>%
  arrange(geslacht, desc(count))
```

```{r sexe-oogkleur-barplot, fig.cap='Aantallen per oogkleur en geslacht: In deze barplot is per geslacht weergegeven hoe vaak een oogkleur is gemeten'}
ggplot(data = male_female,
       mapping = aes(x = results, y = count, fill = geslacht)) + 
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_text(aes(label=count), vjust=1.6, color="white",
            position = position_dodge(0.9), size=3.5) +
  xlab("Oogkleuren") +
  ylab("Aantallen per oogkleur") +
  theme_minimal()
```

Bij de kleuren bruin en hazel is er geen significant verschil tussen
mannen en vrouwen(bij α = 0.05). Als α word verhoogt naar 0.1, zou er
bij hazel wel een significant verschil zijn. Maar dit kan niet worden
meegenomen voor dit onderzoek.

# Discussie en Conclusies

# Online bijlagen

## Notitie software

### Google Docs {#g-docs}

Gebruikte versie: 1.23.162.05.90

Referentie:
<https://play.google.com/store/apps/details?id=com.google.android.apps.docs.editors.sheets&pli=1>

### Apple notities {#a-notes}

Gebruikte versie: geen data

Referentie: <https://apps.apple.com/us/app/notes/id1110145109>

### Keep My Notes {#keep-my-notes}

Gebruikte versie: 1.80.180

Referentie: <https://www.keepmynotes.app/>

## R {#r-lang}

Gebruikte versie: 4.3.0

Referentie: <https://www.r-project.org/>

## R libraries

### plyr {#plyr}

Gebruikte versie: 1.8.8

Referentie:
<https://www.rdocumentation.org/packages/plyr/versions/1.8.8>

### dplyr {#dplyr}

Gebruikte versie: 1.1.2

Referentie:
<https://www.rdocumentation.org/packages/dplyr/versions/1.0.10>

### **ggplot2** {#ggplot2}

Gebruikte versie: 3.4.2

Referentie:
<https://www.rdocumentation.org/packages/ggplot2/versions/3.4.2>

### **knitr** {#knitr}

Gebruikte versie: 1.43

Referentie:
<https://www.rdocumentation.org/packages/knitr/versions/1.43>

### tidyr {#tidyr}

Gebruikte versie: 1.3.0

Referentie: <https://cran.r-project.org/web/packages/tidyr/index.html>

## Software Tools

### R-studio

Gebruikte versie: 2023.03.0 (Windows en MacOS versies)

Gebruiksreden: Het ontwikkelen van R code voor de analyse van de data.

Referentie: <https://posit.co/products/open-source/rstudio/>

# Referenties
